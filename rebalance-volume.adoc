---
sidebar: sidebar 
permalink: rebalance-volume.html 
keywords: rebalance capacity, volume capacity, redistribute capacity 
summary: 時間の経過とともに不均衡が生じるのを避けるために、ボリューム容量をチェックして再調整します。 
---
= ボリューム容量の確認と再調整
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
FlexVol または FlexGroup ボリューム容量のバランスを確認し、ボリューム容量のバランスを再調整して、ファイルをノード内のすべての FlexVol ボリューム間またはすべての構成要素間に均等に分散し、すべてのノードが単一の FlexGroup ボリュームのワークロードに参加するようにします。



== タスクの内容

ボリューム容量の再バランス調整は、FlexVol ボリュームと FlexGroup ボリュームでサポートされています。ボリュームのリバランシングでは、新しいファイルの追加やファイルの増加によって不均衡が長期的に生じた場合に容量が再配分されます。リバランシング処理を手動で開始したら、ファイルを選択し、システムを停止せずに自動的に移動します。ボリューム転送処理はファイルシステムのリソースを消費します。

各ボリュームタイプと再バランス操作は次のように異なります。

.FlexVolボリューム
FlexVolボリュームは、データの管理に柔軟性を提供し、拡張、縮小、移動、効率的なコピーを可能にする論理コンテナです。NASおよびSAN環境で使用できます。

FSx for ONTAPファイルシステム内の同一ノード内のFlexVolは、他のFlexVolと比較してバランス調整が可能です。ファイルシステムにFlexVolが1つしかない場合、リバランスは実行できません。ファイルシステムにノードごとに複数のFlexVolがあり、1つのFlexVolが選択されている場合、そのFlexVolはすべてのFlexVolと比較してバランス調整されますが、移動できるのは選択されたボリュームのみです。

.FlexGroupボリューム
一方、FlexGroupボリュームは、高パフォーマンスと自動負荷分散を実現するように設計されたスケーラブルなNASコンテナです。複数のメンバーボリューム（構成要素）で構成され、トラフィックを透過的に共有します。FlexGroupボリュームは、FlexVolの制限を超える大容量を提供し、最大60PBの容量と4,000億ファイルに対応します。単一の名前空間コンテナを提供することで、管理を簡素化します。

容量は、2 つ以上の高可用性 (HA) ペアを持つスケールアウト FSx for ONTAP ファイル システム内の複数の構成要素に分散されます。各コンスティチュエントは、単一のファイルの最大サイズを決定するコンテナです。FSx for ONTAPでは、ファイルがすべてのコンスティチュエントに均等に分散されるため、すべてのノードが1つのFlexGroupボリュームのワークロードに参加します。

コンスティチュエントがすべてのノードに均等に分散されていないと、FlexGroupボリュームのパフォーマンスが低下します。

FlexGroupボリューム容量のバランスを確認するには、構成要素の現在のレイアウトを評価する必要があります。ボリュームの容量を再調整すると、 NetApp Workload Factory は、偶数個の構成要素を持つ新しい構成要素レイアウトを設計し、すべての HA ペアにデータを均等に分散します。サービスは再バランス計画を実行し、読み取りおよび書き込み操作を改善します。


NOTE: iSCSI や NVMe などの SAN ボリュームでは再バランスはサポートされていません。



== ボリュームのバランスを確認する

FSx for ONTAP ファイル システム内の FlexVol または FlexGroup ボリュームのバランスを確認します。

.開始する前に
* FlexGroupボリュームのバランスは、2つ以上のHAペアで構成されたスケールアウト環境を使用するFSx for ONTAPファイルシステムでのみ使用できます。
* ボリュームの残高を確認するには、 link:manage-links.html["リンクの関連付け"] 。既存のリンクがない場合は、 link:create-link.html["リンクの作成"]を参照してください。ファイルシステムにリンクを関連付けるには、*[アカウント名]*で*[リンクの関連付け]*を選択します。リンクが関連付けられたら、この操作に戻ります。


.手順
. いずれかを使用してログインしlink:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["コンソールエクスペリエンス"^]ます。
. メニューを選択 image:workloads-menu-icon.png["ハンバーガー メニュー アイコンは、ストレージ、eda、ai、データベース、vmware、管理などのワークロードに移動するために使用されます。"] 次に*ストレージ*を選択します。
. [ストレージ] メニューから、*FSx for ONTAP* を選択します。
. *FSx for ONTAP*から、再バランス調整するボリュームを含むファイルシステムのアクションメニューを選択し、*管理*を選択します。
. ファイルシステムの概要で、*[ボリューム]*タブを選択します。
. [ボリューム] タブで、表の上部にある [ボリューム バランスを確認] を選択します。
. ボリューム残高ウィンドウで、次の残高ステータスを確認します。
+
** FlexGroupボリューム
** FlexVolボリューム
+
ボリュームのバランスが崩れた場合は、 <<ボリューム容量の再調整,リバランシング>> 。







== ボリューム容量の再調整

負荷が分散されていない1つ以上のボリュームをリバランシングします。


NOTE: ワークロードファクトリーの管理者は<<ボリュームの再バランス操作を停止する,リバランスを停止する>>手術中。

.開始する前に
* <<ボリュームのバランスを確認する,ボリュームのバランスを確認する>>ボリュームのリバランシング前
* ボリュームをリバランシングするには、が必要です link:manage-links.html["リンクの関連付け"]。既存のリンクがない場合は、 link:create-link.html["リンクの作成"]を参照してください。ファイルシステムにリンクを関連付けるには、*[アカウント名]*で*[リンクの関連付け]*を選択します。リンクが関連付けられたら、この操作に戻ります。
* リバランシングするボリューム上の既存のSnapshotは部分的になり、ボリュームデータのリストアには使用できませんが、リバランシング後に作成された新しいSnapshotを使用してボリュームデータをリストアできます。
* FlexVol ボリュームは、すべてのボリュームリソースを均等にバランス調整するために、まとめて再バランス調整するのが最適です。選択解除されたボリュームは、バランス調整プロセスに積極的に関与しません。


[role="tabbed-block"]
====
.FlexVolボリューム
--
FSx for ONTAPファイルシステムでは、同一ノード内のFlexVolを他のFlexVolと比較してバランス調整できます。ファイルシステムにノードごとに複数のFlexVolがあり、1つのFlexVolを選択した場合、そのFlexVolはすべてのFlexVolと比較してバランス調整されますが、移動できるのは選択されたボリュームのみです。

.手順
. いずれかを使用してログインしlink:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["コンソールエクスペリエンス"^]ます。
. メニューを選択 image:workloads-menu-icon.png["ハンバーガー メニュー アイコンは、ストレージ、eda、ai、データベース、vmware、管理などのワークロードに移動するために使用されます。"] 次に*ストレージ*を選択します。
. [ストレージ] メニューから、*FSx for ONTAP* を選択します。
. *FSx for ONTAP*から、再バランス調整するボリュームを含むファイルシステムのアクションメニューを選択し、*管理*を選択します。
. ファイルシステムの概要で、*[ボリューム]*タブを選択します。
. [ボリューム] タブで、表の上部にある [ボリューム バランスを確認] を選択します。
. ボリューム バランス ウィンドウで、オプションとして FlexVol バランス サマリーの *データ分散* を選択して、アグリゲートごとの使用容量を表示します。
. 1 つ以上の不均衡なボリュームを再バランスするには、「再バランス」を選択します。
. 再バランスウィザードで、手順に従います。
+
.. *最大転送速度*: オプション。デフォルトでは無効です。ファイルシステム上のボリューム移動の帯域幅を制限し、送信ボリュームのレプリケーショントラフィックを遅くするには、スロットルを有効にします。
+
スロットル値をMB/秒単位で入力します。

+
「 * 次へ * 」を選択します。

.. すべての FlexVol ボリュームの現在のレイアウトと提案されたレイアウトを確認し、[次へ] を選択します。
.. リバランス操作を開始する前に、何が起こるかと注意事項を慎重に確認してください。


. [リバランス]*を選択します。


.結果
FlexVol ボリュームのバランスが再調整されます。処理が完了すると、ファイルシステムは元の値に調整されます。

--
.FlexGroupボリューム
--
メンバーボリューム間でデータが再配分され、FlexGroupボリュームのリバランシングが行われます。選択したレイアウトに基づいて、再バランス操作によって FlexGroup メンバー ボリュームが追加され、プロビジョニングされたボリュームのサイズが増加する可能性があります。

.手順
. いずれかを使用してログインしlink:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["コンソールエクスペリエンス"^]ます。
. *ストレージ*で*ストレージへ移動*を選択します
. [ストレージ] メニューから、*FSx for ONTAP* を選択します。
. *FSx for ONTAP*から、再バランス調整するボリュームを含むファイルシステムのアクションメニューを選択し、*管理*を選択します。
. ファイルシステムの概要で、*[ボリューム]*タブを選択します。
. [Volumes]タブで、テーブルの上部にある*[Check FlexGroup balance]*を選択します。
. 1つ以上のアンバランスボリュームをリバランシングするには、FlexGroup balanceウィンドウで* Rebalance *を選択します。
. 再バランスウィザードで、必要なデータ分散レイアウトを選択します。
+
** *パフォーマンス最適化*（推奨）：FlexGroupメンバーボリュームの数とボリュームのプロビジョニングサイズを増やします。NetAppのベストプラクティスに従います。
** *制限付き*：レプリケーション関係のボリュームをサポートします。FlexGroupメンバーボリュームの数とプロビジョニングされるボリュームのサイズは変わりません。選択したすべてのボリュームがレプリケーション関係に含まれている場合はデフォルトで選択されます。
** *手動*：HAペアあたりのFlexGroupメンバーボリュームの必要数を選択します。選択内容によっては、FlexGroupメンバーボリュームの数とボリュームのプロビジョニングサイズが増えることがあります。


. *スロットル*:オプション。デフォルトでは無効です。ファイルシステム上のボリューム移動の帯域幅を制限し、送信ボリュームのレプリケーショントラフィックを遅くするには、スロットルを有効にします。
+
スロットル値をMB/秒単位で入力します。

. レイアウト比較ビューを選択し、*次へ*を選択します。
+
** ボリュームレイアウトの比較
** FSx for ONTAPのレイアウトの比較


. 必要に応じて、リバランシングする前にボリューム移動のリストをダウンロードします。
. [リバランス]*を選択します。


.結果
FlexGroup メンバー ボリュームは、再バランス調整中に一度に 1 つずつ移動されます。処理が完了すると、ファイルシステムは元の値に調整されます。

--
====


== ボリュームの再バランス操作を停止する

リバランス操作はいつでも停止できます。操作は中断されません。操作を停止すると、アクティブなボリュームの移動が中止されます。

後で別の再バランス操作を開始できます。

.手順
. 再バランス操作を開始した後、ボリューム バランス ページで [*再バランスの停止*] を選択します。
. 再バランスの停止ダイアログで、「停止」を選択します。


.結果
ボリュームの再バランス操作が停止し、アクティブなボリュームの移動が中止されます。
