---
sidebar: sidebar 
permalink: create-replication.html 
keywords: replication, replicate, data protection, disaster recovery, data loss 
summary: 予期しない災害が発生した場合のデータ損失を回避するために、FSx for ONTAPファイルシステムのレプリケーション関係を作成します。 
---
= NetApp Workload FactoryでFSx for ONTAPにデータを複製
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
予期しない災害時のデータ損失を防ぐために、NetApp Workload Factory で FSx for ONTAP ファイルシステムのレプリケーション関係を作成します。2つの FSx for ONTAP ファイルシステム間、またはオンプレミスの ONTAP システムと FSx for ONTAP ファイルシステム間でデータをレプリケートできます。

ストレージ VM の移行では、レプリケーション関係を作成した直後にカットオーバー操作を完了する必要があります。



== タスクの内容

レプリケーションは、災害が地域に影響を及ぼす場合にデータを保護します。また、移行目的にも使用できます。

ターゲットファイルシステム内のレプリケートされたボリュームは、データ保護（DP）ボリュームであり、命名形式はです。 `{OriginalVolumeName}_copy`

不変のファイルを含むソース ボリュームを複製する場合、ターゲット ボリュームとファイル システムは、ソース ボリュームの保持期間が終了するまでロックされたままになります。不変ファイル機能は、FSx for ONTAP ファイルシステムのlink:create-volume.html["ボリュームを作成する"]ときに使用できます。

[NOTE]
====
* iSCSI または NVMe プロトコルを使用するブロック ボリュームでは、レプリケーションはサポートされていません。
* 1つのソース（読み取り/書き込み）ボリュームまたは1つのデータ保護（DP）ボリュームをレプリケートできます。カスケードレプリケーションはサポートされていますが、3番目のホップはサポートされていません。詳細については、をご覧ください link:https://review.docs.netapp.com/us-en/workload-fsx-ontap_cascade-replication/cascade-replication.html["カスケードレプリケーション"^]。


====


=== 移行のユースケース

移行ユースケースを選択する場合、オプションで、単一のストレージVMのストレージVMデータと構成設定を複製することを選択できます。データと構成設定を同時に移行する場合は、ボリュームの最後のレプリケーションが過去 24 時間以内に完了していることを確認してください。この機能を使用するには、同じストレージ VM 内のすべてのボリュームを選択する必要があります。すべてのボリュームの階層化ポリシーは、移行のユースケースに推奨されるソースボリュームの階層化ポリシーにデフォルト設定されます。

Workload Factory は、次のストレージシステム間の移行レプリケーションをサポートしています。

* オンプレミスONTAPシステムとFSx for ONTAPファイルシステム
* Cloud Volumes ONTAP および FSx for ONTAP ファイルシステム
* FSx for ONTAPおよびFSx for ONTAPファイルシステム
+
** 第 1 世代から第 1 世代
** 第 1 世代から第 2 世代
** 第2世代から第2世代




ストレージ VM データと構成設定を移行するには、2 つの操作を完了する必要があります。

. <<レプリケーション関係を作成する,レプリケーション関係を作成する>>、ユースケースとして*Migration*を選択し、*Replicate storage VM configuration*を選択します。
. <<Cut over replication,カットオーバーレプリケーション>>ソースファイルシステムからターゲットのFSx for ONTAPファイルシステムにデータと構成設定を永続的に移行します。




== レプリケーション関係を作成する

2つのFSx for ONTAPファイルシステム間、またはオンプレミスONTAPシステムとFSx for ONTAPファイルシステム間でデータを複製します。

.開始する前に
開始する前に、これらの要件を確認してください。

* レプリケーション関係のターゲットに使用するFSx for ONTAPファイル システムが1つ必要です。
* レプリケーション関係に使用する FSx for ONTAP ファイル システムには、関連付けられたリンクが必要です。link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["既存のリンクを関連付ける方法、または新しいリンクを作成して関連付ける方法を学びます"]。リンクを関連付けたら、この操作に戻ります。
* オンプレミス ONTAP システムから FSx for ONTAP ファイルシステムへのレプリケーションの場合は、オンプレミス ONTAP システムが検出されていることを確認してください。
* 使用可能、作成済み、または構成ミス以外の状態のボリュームではレプリケーションはサポートされません。また、ONTAP バージョンに互換性がない場合もサポートされません。
* 移行のユースケースでは、ストレージ VM のデータおよび設定とのレプリケーション関係を作成する前に、ボリュームの最後のレプリケーションが過去 24 時間以内に完了していることを確認してください。


.手順
. いずれかを使用してログインしlink:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["コンソールエクスペリエンス"^]ます。
. メニューを選択 image:workloads-menu-icon.png["ハンバーガー メニュー アイコンは、ストレージ、eda、ai、データベース、vmware、管理などのワークロードに移動するために使用されます。"] 次に*ストレージ*を選択します。
. [ストレージ] メニューから、*FSx for ONTAP* を選択します。
. *FSx for ONTAP*から、レプリケートするボリュームを含むファイルシステムを選択します。
. ファイルシステム内のすべてのボリュームをレプリケートするか、選択したボリュームをレプリケートします。
+
** ファイルシステム内のすべてのボリュームをレプリケートするには、ファイルシステムの概要で* Replicate data *を選択します。
** 選択したボリュームをレプリケートするには：ファイルシステムの概要で*[ボリューム]*タブを選択します。
+
[ボリューム]テーブルで1つ以上のボリュームを選択し、*[データのレプリケート]*を選択します。



. [Replicate data]ページの[Replication target]で、次の情報を指定します。
+
.. *使用ケース*: レプリケーションの次の使用ケースのいずれかを選択します。選択したユースケースに応じて、Workload Factory はベストプラクティスに従って推奨値をフォームに入力します。フォームに入力する際に、推奨値を受け入れることも、変更することもできます。
+
*** 移行：ターゲットのFSx for ONTAPファイルシステムにデータを転送
+
* ストレージ VM 構成のレプリケート * ：オプションで、単一のストレージ VM のストレージ VM データと構成設定をレプリケートするように選択します。データと構成設定を同時に移行する場合は、ボリュームの最後のレプリケーションが過去 24 時間以内に完了していることを確認してください。この機能を使用するには、同じストレージ VM 内のすべてのボリュームを選択する必要があります。すべてのボリュームの階層化ポリシーは、移行のユースケースに推奨されるソースボリュームの階層化ポリシーにデフォルト設定されます。

*** ホットディザスタリカバリ：重要なワークロードの高可用性と迅速なディザスタリカバリを実現
*** コールド/アーカイブのディザスタリカバリ：
+
**** コールドディザスタリカバリ：目標復旧時間（RTO）とオブジェクト復旧時点（RPO）を長くしてコストを削減
**** アーカイブ：長期的なストレージとコンプライアンスのためにデータをレプリケート


*** その他
+
さらに、ユースケースの選択によって、レプリケーションポリシー（SnapMirrorポリシー（ONTAP））も決まります。レプリケーションポリシーを説明するために使用される用語は、から来てlink:https://docs.netapp.com/us-en/ontap/data-protection/default-protection-policies-concept.html["ONTAP 9 のドキュメント"^]います。

+
**** 移行などの場合、レプリケーションポリシーは_MirrorAllSnapshots_です。_MirrorAllSnapshots_は、すべてのSnapshotと最新のアクティブファイルシステムをミラーリングする非同期ポリシーです。
**** ホット、コールド、またはアーカイブのディザスタリカバリの場合、レプリケーションポリシーは_MirrorAndVault_と呼ばれます。_MirrorAndVault_は、最新のアクティブファイルシステムと日単位および週単位のSnapshotをミラーリングするための非同期バックアップポリシーです。
+
すべてのユースケースで、Snapshotの長期保持を有効にすると、デフォルトのレプリケーションポリシーは_MirrorAndVault_です。





.. * FSx for ONTAPファイルシステム*：対象となるFSx for ONTAPファイルシステムのクレデンシャル、リージョン、FSx for ONTAPファイルシステム名を選択します。
.. * Storage VM名*：ドロップダウンメニューからStorage VMを選択します。選択したストレージ VM は、このレプリケーション関係で選択されたすべてのボリュームのターゲットになります。
.. *ボリューム名*：ターゲットボリューム名は次の形式で自動的に生成されます `{OriginalVolumeName}_copy`。自動生成されたボリューム名を使用するか、別のボリューム名を入力できます。
.. *階層化ポリシー*：ターゲットボリュームに格納されているデータの階層化ポリシーを選択します。階層化ポリシーは、選択したユースケースに応じた推奨される階層化ポリシーにデフォルトで設定されます。
+
_バランス (自動)_ は、Workload Factory コンソールを使用してボリュームを作成するときのデフォルトの階層化ポリシーです。ボリューム階層化ポリシーの詳細については、以下を参照してください。link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/volume-storage-capacity.html#data-tiering-policy["ボリュームのストレージ容量"^] AWS FSx for NetApp ONTAPドキュメント。ワークロード ファクトリーは、ワークロード ファクトリー コンソールで階層化ポリシーにユースケース ベースの名前を使用し、括弧内に FSx for ONTAP階層化ポリシー名を含めることに注意してください。

+
移行ユースケースを選択した場合、Workload Factory はソース ボリュームの階層化ポリシーをターゲット ボリュームにコピーすることを自動的に選択します。階層化ポリシーのコピーの選択を解除し、レプリケーション対象として選択したボリュームに適用する階層化ポリシーを選択できます。

.. *最大転送速度*：* Limited *を選択し、最大転送速度をMB/秒単位で入力します。または、*無制限*を選択します。
+
制限がないと、ネットワークとアプリケーションのパフォーマンスが低下する可能性があります。また、FSx for ONTAPファイルシステムは、主にディザスタリカバリに使用されるワークロードなど、重要なワークロードには無制限の転送速度を推奨します。



. [Replication settings]で、次の情報を指定します。
+
.. *レプリケーション間隔*：ソースボリュームからターゲットボリュームにSnapshotを転送する頻度を選択します。
.. *長期保存*：オプションで、長期保存用のスナップショットを有効にします。長期保存により、サイト全体に障害が発生してもビジネスサービスの運用を継続できるため、アプリケーションをセカンダリコピーを使用して透過的にフェイルオーバーできます。
+
長期保存のないレプリケーションでは、_MirrorAllSnapshots_ ポリシーが使用されます。長期保存を有効にすると、レプリケーションに _MirrorAndVault_ ポリシーが割り当てられます。

+
長期保持を有効にする場合は、既存のポリシーを選択するか、新しいポリシーを作成して、レプリケートするSnapshotと保持する数を定義します。

+

NOTE: 長期保存には、ソースラベルとターゲットラベルを一致させる必要があります。必要に応じて、Workload Factoryで不足しているラベルが作成されることがあります。

+
*** *既存のポリシーを選択*：ドロップダウンメニューから既存のポリシーを選択します。
*** *新しいポリシーを作成*：*ポリシー名*を入力します。


.. *不変のスナップショット*: オプション。このポリシーで作成されたSnapshotが保持期間中に削除されないようにするには、[変更不可のSnapshotを有効にする]*を選択します。
+
*** [Retention Period]*を時間、日、月、または年数で設定します。
*** * Snapshotポリシー*：表で、Snapshotポリシーの頻度と保持するコピーの数を選択します。Snapshotポリシーは複数選択できます。


.. *S3 アクセス ポイント*: オプションで、S3 アクセス ポイントを接続して、AWS S3 API 経由で NFS または SMB/CIFS ボリューム上にある FSx for ONTAPファイル システム データにアクセスします。ファイル アクセス タイプのみがサポートされます。以下の詳細を提供します:
+
*** *S3 アクセス ポイント名*: S3 アクセス ポイントの名前を入力します。
*** *ユーザー*: ボリュームへのアクセス権を持つ既存のユーザーを選択するか、新しいユーザーを作成します。
*** *ユーザー タイプ*: ユーザー タイプとして *UNIX* または *Windows* を選択します。
*** *ネットワーク構成*：*インターネット* または *仮想プライベート クラウド (VPC)* を選択します。選択するネットワークの種類によって、アクセス ポイントがインターネットからアクセスできるか、特定の VPC に制限されるかが決まります。
*** *メタデータを有効にする*：メタデータを有効にすると、S3 アクセス ポイントからアクセスできるすべてのオブジェクトを含む S3 テーブルが作成され、監査、ガバナンス、自動、分析、最適化に使用できるようになります。メタデータを有効にすると追加の AWS コストが発生します。詳細については、link:https://aws.amazon.com/s3/pricing/["Amazon S3 価格設定ドキュメント"^]を参照してください。


.. *S3 アクセス ポイント タグ*：オプションで、最大 50 個のタグを追加できます。




. 「 * Create * 」を選択します。


.結果
レプリケーション関係は、ターゲットのFSx for ONTAPファイルシステムの*レプリケーション関係*タブに表示されます。

移行のためにレプリケーション関係を作成した場合は、ストレージ VM のデータと構成設定をターゲットの FSx for ONTAP ファイルシステムに移行するために、すべてのボリュームとそれに関連付けられたストレージ VM をカットオーバーする必要があります。



== 移行ユースケースのカットオーバーレプリケーション

移行ユースケースのレプリケーション関係を作成した後、ストレージVMデータと構成設定をターゲットのFSx for ONTAPファイルシステムに移行するには、レプリケーションをカットオーバーする必要があります。カットオーバーレプリケーションは、データとストレージVMの構成設定をソースファイルシステムからターゲットのFSx for ONTAPファイルシステムに永続的に移行します。カットオーバー中に、データが最後に複製されます。カットオーバーが完了すると、システムはソースボリュームを削除します。この操作を元に戻すことはできません。

.開始する前に
開始する前に、これらの要件を確認してください。

* レプリケーションを切り替える前に、ストレージ VM へのクライアントアクセスをすべて停止します。
* レプリケーションを切り替える前に、すべてのソースボリュームがデータを提供していないことを確認してください。
* レプリケーションを切り替える前に、ソースボリュームとターゲットボリューム間でデータが同期されていることを確認します。
* レプリケーション関係に使用する FSx for ONTAP ファイル システムには、関連付けられたリンクが必要です。link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["既存のリンクを関連付ける方法、または新しいリンクを作成して関連付ける方法を学びます"]。リンクを関連付けたら、この操作に戻ります。


.手順
. いずれかを使用してログインしlink:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["コンソールエクスペリエンス"^]ます。
. メニューを選択 image:workloads-menu-icon.png["ハンバーガー メニュー アイコンは、ストレージ、eda、ai、データベース、vmware、管理などのワークロードに移動するために使用されます。"] 次に*ストレージ*を選択します。
. [ストレージ] メニューから、*FSx for ONTAP* を選択します。
. *FSx for ONTAP*から、レプリケートするボリュームを含むファイルシステムを選択します。
. * レプリケーション関係 * タブを選択します。
. レプリケーション関係テーブルで、切り替えるレプリケーション関係を選択し、*レプリケーションの切り替え*を選択します。
. カットオーバーレプリケーションダイアログの情報を確認し、_cut over_ と入力して確定します。


. *カットオーバー* を選択します。


.結果
カットオーバー後、ソースボリュームは削除され、ターゲットボリュームは読み取り / 書き込みになります。カットオーバー後、ターゲットボリュームに対してlink:change-tiering-policy.html["階層化ポリシーを変更する"]できます。
